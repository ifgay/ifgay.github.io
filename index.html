<!DOCTYPE html>
<html lang="zh_cn">

<head>
  <meta charset="UTF-8">
  <title>笔记-ADOG-note-view</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
  <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">
  <link rel="stylesheet" href="./css/dist.css">
</head>

<body ontouchstart>

  <!-- 第一个tab -->
  <script type="text/template" id="tab1_compile">
    <div class="header_title">
      <img src="./icon/back.svg" style="margin-left: 7px;">
     <span class="h_tilt">2020年3月2日 晴 <img src="./icon/weather/sun.svg" alt=""> </span> 
     <i class="weui-icon-search" style="font-size: 24px;margin-right: 7px;"></i>
    </div>
  </script>


  <div class="weui-tab">
    <div class="weui-tab__bd">
      <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active">
      </div>
      <div id="tab2" class="weui-tab__bd-item">
        <div class="header_title">标题</div>
      </div>
      <div id="tab3" class="weui-tab__bd-item">
        <div class="header_title">标题</div>
      </div>
    </div>

    <div class="weui-tabbar" style="position: fixed;">
      <a href="#tab1" class="weui-tabbar__item weui-bar__item--on">
        <div class="weui-tabbar__icon">
          <img src="./icon/note.svg" alt="">
        </div>
        <p class="weui-tabbar__label">日记</p>
      </a>
      <a href="#tab2" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
          <img src="./icon/trends.svg" alt="">
        </div>
        <p class="weui-tabbar__label">收藏</p>
      </a>
      <a href="#tab3" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
          <img src="./icon/tool.svg" alt="">
        </div>
        <p class="weui-tabbar__label">工具</p>
      </a>
    </div>
  </div>

</body>

<script src="http://jqweui.com/dist/lib/jquery-2.1.4.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js"></script>
<script src="./plug/fastclick.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
<script src="./plug/template-web.js"></script>
<script>

  let kit = {
    getLocation: () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showErr);
      } else {
        $.toptip('浏览器不支持定位', 'error');
      }
      function showPosition(position) {
        console.log(position);
        alert(position.coords.latitude,position,position.coords.longitude)
        $.getJSON('http://api.map.baidu.com/geocoder/v2/?ak=71709218d45a706b9c7e3abc2f037b23&callback=?&location='
          + position.coords.latitude + ',' + position.coords.longitude
          + '&output=json&pois=1', function (res) {
            //addressComponent => {city: "广州市", district: "天河区", province: "广东省", street: "广州大道", street_number: "中922号-之101-128"} 
            console.log(res);
          });
      }
      function showErr(error) {
        let error_code_map={
          1:"您拒绝了授权定位",
          2:"获取不到当前位置信息",
          3:"获取定位超时",
          4:"获取定位出现异常错误"
        }
        $.toptip(error_code_map[error.code]||'获取定位出现预期外错误','error')
      }

    }
  }
  $.template = template;
  $(event_onload_handler => {
    FastClick.attach(document.body);

    //使用闭包保存作用域
    function packet_data() {
      let __local = {}
      return {
        set: (key, val) => {
          return __local[key] = val
        },
        get: (key) => {
          return __local[key]
        },
        save: (key, val) => {
          localStorage.setItem(key, val)
        },
        read: (key) => {
          localStorage.getItem(key)
        }
      }
    }

    let store = packet_data()

    //加载配置文件
    $.showLoading('加载配置文件...');
    $.ajax('./php/config.json', {
      method: 'get',
      success: res => {
        let base = Object.assign(kit, res)
        setTimeout(() => {
          $.hideLoading();
          configNext.call(base, store);
        }, 700);
      }
    })
  })



  //这里开始主函数
  function configNext(store) {
    tabOneRender.call(this, store)
    tabTwoRender.call(this, store)
    tabThreeRender.call(this, store)
  }

  function tabOneRender(store) {
    this.getLocation()
    store.set('name', 'pp')
  }
  function tabTwoRender(store) {
    console.log(store.get('name'));
  }
  function tabThreeRender(store) {

  }

</script>

</html>