<!DOCTYPE html>
<html lang="zh_cn">

<head>
  <meta charset="UTF-8">
  <title>笔记-ADOG-note-view</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
  <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">
  <link rel="stylesheet" href="./css/dist.css">
</head>

<body ontouchstart>



    <!-- <div class="header_title" style="display:none" id='tabOneHead'>
      <img src="./icon/back.svg" style="margin-left: 7px;">
     <span class="h_tilt flex_center">{{data.date}}
      <span class='wheather_type'>{{data.weather}} </span> 
      <img src="./icon/weather/sun.svg" class='weather_icon' alt=""> 
    </span> 
     <i class="weui-icon-search btn_search" style="font-size: 24px;margin-right: 7px;"></i>
    </div> -->
  <!-- 列表页面 -->
  <!-- 第一个tab -->
  <script type="text/template" id="tab1CompileItem">

  <div class="weui-panel">
    <div class="weui-panel__hd"><a href="https://github.com/ifgay/ifgay.github.io/php/{{data.file}}" style="text-decoration: underline;color:var(--info);">git:./php/{{data.file}}</a> </div>
    <div class="weui-panel__bd">
      <div class="weui-media-box weui-media-box_text">
        <h4 class="weui-media-box__title">{{data.title}}</h4>
        <p class="weui-media-box__desc" style="line-height:1.4;">{{data.desc}}</p>
        <ul class="weui-media-box__info">
          <li class="weui-media-box__info__meta">{{data.date}}</li>
          <li class="weui-media-box__info__meta weui-media-box__info__meta_extra"><a href="https://github.com/ifgay" style="color:#cecece;">ifgay</a> </li>
        </ul>
      </div>
    </div>
  </div>

  </script>


  <div class="weui-tab">
    <div class="weui-tab__bd">
      <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active">


        <!-- 搜索栏 -->
        <div class="weui-search-bar fixed_top" style="width: 100%;z-index: 90809;" id="searchBar">
          <form class="weui-search-bar__form">
            <div class="weui-search-bar__box">
              <i class="weui-icon-search"></i>
              <input type="search" class="weui-search-bar__input" id="searchInput" placeholder="搜索" required="">
              <a href="javascript:" class="weui-icon-clear" id="searchClear"></a>
            </div>
            <label class="weui-search-bar__label" id="searchText">
              <i class="weui-icon-search"></i>
              <span>搜索</span>
            </label>
          </form>
          <a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
        </div>
        <br>
        <br>


      </div>
      <div id="tab2" class="weui-tab__bd-item">
        <div class="header_title">标题</div>
      </div>
      <div id="tab3" class="weui-tab__bd-item">
        <div class="header_title">标题</div>
      </div>
    </div>

    <div class="weui-tabbar" style="position: fixed;">
      <a href="#tab1" class="weui-tabbar__item weui-bar__item--on">
        <div class="weui-tabbar__icon">
          <img src="./icon/note.svg" alt="">
        </div>
        <p class="weui-tabbar__label">日记</p>
      </a>
      <a href="#tab2" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
          <img src="./icon/trends.svg" alt="">
        </div>
        <p class="weui-tabbar__label">收藏</p>
      </a>
      <a href="#tab3" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
          <img src="./icon/tool.svg" alt="">
        </div>
        <p class="weui-tabbar__label">工具</p>
      </a>
    </div>
  </div>

</body>

<script src="http://jqweui.com/dist/lib/jquery-2.1.4.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js"></script>
<script src="./plug/fastclick.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
<script src="./plug/template-web.js"></script>
<script>

  let kit = {
    getLocation: () => {
      return new Promise((resolve) => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition, showErr);
        } else {
          $.toptip('浏览器不支持定位', 'error');
        }
        function showPosition(position) {
          resolve(position.coords)
        }
        function showErr(error) {
          let error_code_map = {
            1: "您拒绝了授权定位",
            2: "获取不到当前位置信息",
            3: "获取定位超时",
            4: "获取定位出现异常错误"
          }
          $.toptip(error_code_map[error.code] || '获取定位出现预期外错误', 'error')
          resolve(-1)
        }
      })
    },
    nowDate: () => {
      let now = new Date()
      return `${now.getFullYear()}年${now.getMonth() + 1}月${now.getDay()}日`
    }
  }
  $.template = template;
  $(event_onload_handler => {
    FastClick.attach(document.body);

    //使用闭包保存作用域
    function packet_data() {
      let __local = {}
      return {
        set: (key, val) => {
          return __local[key] = val
        },
        get: (key) => {
          return __local[key]
        },
        save: (key, val) => {
          localStorage.setItem(key, val)
        },
        read: (key) => {
          localStorage.getItem(key)
        }
      }
    }

    let store = packet_data()

    //加载配置文件
    $.showLoading('加载配置文件...');
    $.ajax({
      url: '/php/config.json',
      method: 'get',
      success: res => {
        let base = Object.assign(kit, res)
        //加载日记页面
        $.ajax({
          method: 'get',
          url: '/php/count_file.txt',
          success: count => {
            console.log(count);
            store.set('count_file', parseInt(count))
          }
        }).then(next => {
          //加载首页列表 5 个
          $.ajax({
            method: 'get',
            url: './php/notes.json',
            success: note => {
              console.log(note);
              store.set('note', note)
            }
          }).then(next => {
            let length = store.get('count_file') < 6 ? store.get('count_file') : 6;
            let arr = store.get('note')['fileList'];
            for (let i = 0; i < length; i++) {
              console.log(arr[i]);
              append_one_note(arr[i])
              
            }
          })
        })

        setTimeout(() => {
          $.hideLoading();
          configNext.call(base, store);
        }, 700);
      }
    })
  })

  let source_map = {
    wheatherImg: [
      '',
      `./icon/weather/sun.svg`,
      `./icon/weather/rain.svg`,
      `./icon/weather/cloud.svg`,
    ]
  }

  let tag_map = {

  }


  function append_one_note(data) {
    //添加一个item 
    let htm = $.template('tab1CompileItem', {
      data: data
    })
    $('#tab1').append(htm)
  }


  //这里开始主函数
  function configNext(store) {
    tabOneRender.call(this, store)
    tabTwoRender.call(this, store)
    tabThreeRender.call(this, store)
  }

  function tabOneRender(store) {
    let that = this
    let data = Object.assign(that.defaultPosition, {
      date: kit.nowDate()
    })





    //事件
    $('.btn_search').click(eve => {
      $('#searchBar').fadeToggle()
      $('#tabOneHead').fadeOut()
    })



    this.getLocation().then(position => {
      if (position != -1) {
        //
      }
    })
  }




  function tabTwoRender(store) {
    console.log(store.get('name'));
  }
  function tabThreeRender(store) {

  }

</script>

</html>